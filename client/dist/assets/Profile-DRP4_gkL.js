import{u as J,d as M,r as o,j as e,L as u,e as V,f as E,g as q,h as A,i as h,k as _,s as H}from"./index-CKb6SvpI.js";import{F as X,a as Y,b as B}from"./index-BCDDjAw7.js";function Q(){const{currentUser:i,loading:b,error:w}=J(s=>s.user),a=M(),y=o.useRef(null),[m,C]=o.useState(void 0),[p,N]=o.useState(0),[L,d]=o.useState(!1),[F,D]=o.useState(!1),[x,v]=o.useState({}),[k,g]=o.useState(!1),[f,S]=o.useState([]);o.useEffect(()=>{m&&O(m)},[m]);const O=async s=>{if(!s){console.error("No file selected.");return}const t="real_estate_uploads",l="dtznzf4ih",c=new FormData;c.append("file",s),c.append("upload_preset",t);try{const r=new XMLHttpRequest;r.open("POST",`https://api.cloudinary.com/v1_1/${l}/image/upload`,!0),r.upload.onprogress=n=>{if(n.lengthComputable){const j=Math.round(n.loaded*100/n.total);N(j)}},r.onload=async()=>{if(r.status===200){const n=JSON.parse(r.responseText);n.secure_url?(v(j=>({...j,avatar:n.secure_url})),N(100)):(console.error("Cloudinary upload failed:",n),d(!0))}else console.error("Upload failed with status:",r.status),d(!0)},r.onerror=()=>{console.error("Error uploading to Cloudinary."),d(!0)},r.send(c)}catch(r){console.error("Error uploading to Cloudinary:",r),d(!0)}},U=s=>{v({...x,[s.target.id]:s.target.value})},P=async s=>{s.preventDefault(),a(V());try{const l=await(await fetch(`/api/user/update/${i._id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)})).json();if(l.success===!1){a(E(l.message));return}a(q(l)),D(!0)}catch(t){a(E(t.message))}},$=async()=>{try{a(A());const t=await(await fetch(`/api/user/delete/${i._id}`,{method:"DELETE"})).json();if(t.success===!1){a(h(t.message));return}a(_(t))}catch(s){a(h(s.message))}},T=async()=>{try{a(H());const t=await(await fetch("/api/auth/signout")).json();if(t.success===!1){a(h(t.message));return}a(_(t))}catch(s){a(h(s.message))}},R=async()=>{try{g(!1);const t=await(await fetch(`/api/user/listings/${i._id}`)).json();if(t.success===!1){g(!0);return}S(t)}catch(s){console.error("Error fetching listings:",s),g(!0)}},z=async s=>{try{const l=await(await fetch(`/api/listing/delete/${s}`,{method:"DELETE"})).json();if(l.success===!1){console.log(l.message);return}S(c=>c.filter(r=>r._id!==s))}catch(t){console.log(t.message)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-lg mx-auto mt-10 bg-white p-6 rounded-xl shadow-lg text-center space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Profile"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("input",{type:"file",hidden:!0,ref:y,accept:"image/*",onChange:s=>C(s.target.files[0])}),e.jsxs("div",{className:"relative w-24 h-24 mx-auto rounded-full overflow-hidden border-2 border-gray-300 cursor-pointer",onClick:()=>y.current.click(),children:[e.jsx("img",{src:x.avatar||i.avatar||"https://via.placeholder.com/100",alt:"profile",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(X,{className:"text-white text-2xl"})})]}),p>0&&p<100&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Uploading ",p,"%"]}),L&&e.jsx("p",{className:"text-red-500 text-sm",children:"Error uploading image"}),e.jsx("input",{type:"text",id:"username",placeholder:"Username",defaultValue:i.username,onChange:U,className:"w-full p-2 border rounded-md"}),e.jsx("input",{type:"email",id:"email",placeholder:"Email",defaultValue:i.email,onChange:U,className:"w-full p-2 border rounded-md"}),e.jsx("input",{type:"password",id:"password",placeholder:"Password",className:"w-full p-2 border rounded-md"}),e.jsx("button",{type:"submit",disabled:b,className:"w-full p-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition",children:b?"Updating...":"Update"}),e.jsx(u,{to:"/create-listing",className:"w-full p-2 bg-green-600 text-white font-semibold rounded-md text-center block hover:bg-green-700 transition",children:"Create Listing"})]}),e.jsxs("div",{className:"flex justify-between text-gray-600 text-sm",children:[e.jsxs("button",{onClick:$,className:"flex items-center space-x-2 hover:text-red-600 transition",children:[e.jsx(Y,{})," ",e.jsx("span",{children:"Delete Account"})]}),e.jsxs("button",{onClick:T,className:"flex items-center space-x-2 hover:text-blue-600 transition",children:[e.jsx(B,{})," ",e.jsx("span",{children:"Sign Out"})]})]}),w&&e.jsx("p",{className:"text-red-500",children:w}),F&&e.jsx("p",{className:"text-green-500",children:"Profile updated successfully!"})]}),e.jsxs("div",{className:"max-w-3xl mx-auto mt-10 bg-white p-6 rounded-xl shadow-lg space-y-4",children:[e.jsx("button",{onClick:R,className:"w-full p-2 bg-gray-800 text-white font-semibold rounded-md hover:bg-gray-900 transition",children:"Show Listings"}),k&&e.jsx("p",{className:"text-red-500 text-center",children:"Error showing listings"}),f&&f.length>0&&e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-4",children:"Your Listings"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(s=>e.jsxs("div",{className:"border rounded-lg overflow-hidden shadow-md hover:shadow-lg transition",children:[e.jsx(u,{to:`/listing/${s._id}`,children:e.jsx("img",{src:s.imageUrls[0],alt:"listing cover",className:"w-full h-40 object-cover"})}),e.jsxs("div",{className:"p-4",children:[e.jsx(u,{to:`/listing/${s._id}`,className:"text-lg font-semibold text-gray-800 hover:text-blue-500 transition",children:s.name}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("button",{onClick:()=>z(s._id),className:"p-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition",children:"Delete"}),e.jsx(u,{to:`/update-listing/${s._id}`,children:e.jsx("button",{className:"p-1 bg-green-500 text-white rounded-md hover:bg-green-600 transition",children:"Edit"})})]})]})]},s._id))})]})]})]})}export{Q as default};
